# Common conventions

#### 1. Function calls

{% embed url="https://textbook.cs161.org/memory-safety/x86.html#28-x86-function-calls" %}

Following the steps outlined in the textbook above regarding function calls, I will list out the corresponding **x86** (32-bit) assembly codes. Note that for this example, we will draw the memory layout with the highest address at the _**top**_, while the lower addresses appear at the _**bottom**_ visually. However, the `EBP` and `ESP` will still point to the higher and lower addresses of the stack frame respectively.

<mark style="color:$success;">**1.1**</mark> **Push arguments onto the stack**

> Remember that **x86** passes arguments by pushing them onto the stack&#x20;

**1.1.2 State of the memory before**

```

 Highest address	|----->	+------------------------+ <--EBP
			|	| Stack frame for "main" |			 
			|	|------------------------| <--ESP			 
			|	| 			 |
			|	|------------------------|			 
			|	|			 |
			|	|------------------------|
		STACK---|	|			 |		 	
			|	|------------------------|
			|	|			 |	
			|	|------------------------|
			|	|			 |	
			|	|------------------------|
			|	|			 |	
			|	|------------------------|
			|	|	...		 |	
			|----->	|------------------------|
			|	|  Code for "test"	 |	 	
		CODE---	|	|------------------------|
			|	|  Code for "main"	 |	 	
 Lowest address		|----->	|------------------------| 

```

**1.1.3 State of the memory after instruction**

```nasm
push arg1 ; push first arg1 to stack
push arg2 ; push second arg2 to stack
```

<pre><code>
 Highest address	|----->	+------------------------+ &#x3C;--EBP
			|	| Stack frame for "main" |			 
			|	|------------------------| 			 
			|	|        arg2	         |
			|	|------------------------|			 
			|	|	 arg1		 |
			|	|------------------------| <a data-footnote-ref href="#user-content-fn-1">&#x3C;--ESP</a>
		STACK---|	|			 |		 	
			|	|------------------------|
			|	|			 |	
			|	|------------------------|
			|	|			 |	
			|	|------------------------|
			|	|			 |	
			|	|------------------------|
			|	|	...		 |	
			|----->	|------------------------|
			|	|  Code for "test"	 |	 	
		CODE---	|	|------------------------|
			|	|  Code for "main"	 |	 	
 Lowest address		|----->	|------------------------| 

</code></pre>

* As we can see from the stack content after the instruction, **arg2** is pushed first before **arg1**. This is because arguments are pushed onto the stack in reverse order



<mark style="color:$success;">**1.2**</mark> ...



```nasm
push ebp 
mov ebp, esp
```









[^1]: ESP decrements by 4\*2 = 8
