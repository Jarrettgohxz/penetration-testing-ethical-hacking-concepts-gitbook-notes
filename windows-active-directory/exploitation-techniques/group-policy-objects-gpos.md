# Group Policy Objects (GPOs)

A Group Policy Object (GPO) is a virtual collection of policy settings, represented by a unique name called a GUID. The GPOs of an AD network is usually stored in the **SYSVOL** directory: `\\domain\SYSVOL`, and can be viewed with:

```powershell
# From a domain-joined machine
C:\> dir \\domain\SYSVOL
```

### Group Policy Management

A mechanism to deploy a configuration from a central location, by defining policies directly on the AD structure for AD objects such as specific _OU_ or _group_. Domain-joined computers would then be able to pull all policies from **SYSVOL** periodically and apply relevant ones.

By default, policies are replicated every 15 minutes through the **gpupdate** application. However, we can manually trigger this application from the command prompt to apply policies instantly:

```powershell
C:\> gpupdate
C:\> gpupate /force
```

{% embed url="https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/gpupdate" %}

### Exploitation example

Scenario adapted from TryHackMe Exploiting AD room:

{% embed url="https://tryhackme.com/room/exploitingad" %}

Suppose we have stolen credentials for a certain user named **SVCSERVMAN**. We have found that this user has _GenericWrite_ permissions on the **MANAGEMENT SERVER PUSHES** GPO, which has a [_GpLink_](https://bloodhound.specterops.io/resources/edges/gp-link) permission on the **MANAGEMENT SERVERS** OU which contains the **THMSERVER2** machine. We can observe the behavior from the following Bloodhound output:

<figure><img src="../../.gitbook/assets/image (59).png" alt=""><figcaption></figcaption></figure>

This provides us the following exploitation opportunity:

a. Add a user account we control to the local Administrators and local Remote Desktop Users group on the **MANAGEMENT SERVER PUSHES** GPO

* This exploits the _GenericWrite_ permissions
* This will allow us to gain a remote desktop session as an administrator

b. Since the **MANAGEMENT SERVER PUSHES** GPO has a [_GpLink_](https://bloodhound.specterops.io/resources/edges/gp-link) permission on the **MANAGEMENT SERVERS** OU, this means that any changes we make to the GPO will apply to the OU (and any other users or computers contained within that OU)

c. After we add our user account to the relevant groups (part #a), we will have the relevant permissions on the **THMSERVER2.ZA.TRYHACKME.LOC** machine



