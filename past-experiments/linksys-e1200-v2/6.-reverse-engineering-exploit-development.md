# 6. Reverse engineering (exploit development)

Given the information we have gathered from the previous section, we can attempt to perform reverse engineering to replicate the steps taken to discover the CVE, and potentially escalate it to RCE.

### 6.1 Transfer binary from host device

Before we continue, let's install the busybox binary on the device (via UART), which provides us with a more comprehensive set of tools

{% embed url="https://www.busybox.net/" %}

**Host**:

```shellscript
$ wget https://busybox.net/downloads/binaries/1.21.1/busybox-mipsel

# host "busybox-mipsel" binary with a python3 server
$ python3 -m http.server <port>
```

**Device (UART console)**:

{% code title="UART console" %}
```console
# wget http://<HOST_IP>:<port>/busybox-mipsel -O /tmp/busybox-mipsel

#! use the newly retrieved "busybox-mipsel" binary
# /tmp/busybox-mipsel --help
```
{% endcode %}

### 6.2 Transfer binary from device to host

#### 6.2.1 tftp

From host connecting to device (via network):

```shellscript
$ tftp -4 <router_ip> <port> 
tftp> get <file>

# or in 1 command
$ tftp -4 <router_ip> <port>  -c get <file>
```

#### 6.2.2 Netcat (busybox)

**Device (UART console)**:

{% code title="UART console" %}
```console
# /tmp/busybox-mipsel nc <router_ip> <port> < /tmp/gn-httpd
```
{% endcode %}

**Host**:

```shellscript
$ nc -lvp <port> > /path/to/gn-httpd
```

* We can now access the vulnerable binary from `/path/to/gn-httpd` on the host machine

### 6.3 Ghidra

...

### 6.4 `gdb`, `gdbserver`&#x20;

{% embed url="https://docs.hex-rays.com/user-guide/debugger/remote-debugging/remote-gdb-debugger/debugging-with-gdbserver" %}

{% embed url="https://gcc.gnu.org/onlinedocs/gcc-4.8.5/gnat_ugn_unw/Remote-Debugging-using-gdbserver.html" %}

#### 6.4.1 Compile `gdb` for target

{% embed url="https://github.com/guyush1/gdb-static" %}

To start off, we have to compile GDB for our target architecture `xxxx`, as found from the previous enumeration step:

```shellscript
$ 
```

#### 6.4.2 `gdbserver` on target router

Next, we can run `gdbserver` on the target router:

{% code title="UART console" %}
```console
# gdbserver localhost:<port> <program>

#! eg. 
# gdbserver localhost:8888 /path/to/httpd
```
{% endcode %}

Alternatively, launch from PID of a running program:

{% code title="UART console" %}
```console
# gdbserver localhost:<port> --attach <PID_of_program>

#! eg.
# pidof httpd
# gdbserver localhost:8888 --attach <PID>
```
{% endcode %}

#### 6.4.3 Connect to remote target from host machine

* To debug (using `gdb`) from the host machine:

```shellscript
$ gdb
gdb> target remote <host>:<port>

# eg.
gdb> target remote 8.8.8.8:8888
```

### 6.5 xxxx

...
