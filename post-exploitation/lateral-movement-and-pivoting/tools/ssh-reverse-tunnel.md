# SSH (reverse tunnel)

{% embed url="https://jarrettgxz-sec.gitbook.io/networking-concepts/ssh/ssh-tunneling/reverse-ssh-tunnel" %}

{% embed url="https://github.com/haad/proxychains" %}

{% embed url="https://manpages.debian.org/trixie/proxychains4/proxychains4.1.en.html" %}

Secure-SHell (**SSH**) can be used for pivoting around a network. Particularly, this is achieved with the reverse tunnel (`-R`) option provided by SSH.

```sh
$ ssh -R <listen_port> <remote_host> [-p <port>]
```

Given the following setup:

1. Attacker machine

* IP: **1.1.1.1/24**

2. Pivot machine (compromised)

* IP: **1.1.1.2/24** and **2.2.2.2.2/24**

3. Target machine

* Only accessible from the pivot machine
* IP: **2.2.2.3/24**<br>

Suppose we want to access the target machine from the attacker machine. However, the target machine is only accessible from the pivot machine on the particular interface (**2.2.2.0/24**). To bypass this restriction, we can use the following SSH command to convert the pivot machine to a _**SOCKS5**_ proxy:

{% code title="Attacker machine@1.1.1.1" overflow="wrap" %}
```sh
$ ssh -R 8888 1.1.1.2 -N
```
{% endcode %}

Now, we can access the target machine (**2.2.2.3/24** network) on port **8888** from the attacker machine, as if they are on the same network. We can use _**proxychains**_ to achieve this:

{% code title="Attacker machine@1.1.1.1" overflow="wrap" %}
```sh
$ cat /etc/proxychains4.conf 
...
socks5  127.0.0.1 8888

# eg. perform nmap scan through the pivot (acting as proxy)
$ proxychains4 -f /etc/proxychains4.conf nmap -sT 2.2.2.3 

```
{% endcode %}

> Note that certain commands or options may not work as expected over the SOCKS proxy, eg. `nmap -sS` . Moreover, additional configurations may be required for DNS resolution to be resolved over the proxy.

